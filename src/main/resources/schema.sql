DROP TABLE IF EXISTS COMMENTS;
DROP TABLE IF EXISTS BOOKINGS;
DROP TABLE IF EXISTS ITEMS;
DROP TABLE IF EXISTS ITEM_REQUESTS;
DROP TABLE IF EXISTS USERS;

CREATE TABLE IF NOT EXISTS USERS (
  ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  NAME VARCHAR(255) NOT NULL,
  EMAIL VARCHAR(512) NOT NULL,
  CONSTRAINT pk_user PRIMARY KEY (ID),
  CONSTRAINT UQ_USER_EMAIL UNIQUE (EMAIL)
 );

CREATE TABLE IF NOT EXISTS ITEM_REQUESTS (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT null primary key,
    DATE TIMESTAMP WITHOUT TIME ZONE,
	DESCRIPTION VARCHAR(2000),
	AUTHOR BIGINT REFERENCES USERS (ID) ON DELETE CASCADE not null
);

CREATE TABLE IF NOT EXISTS ITEMS (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT null primary key,
	NAME VARCHAR(200) NOT NULL,
	DESCRIPTION VARCHAR(2000),
	AVAILABLE BOOLEAN,
	OWNER BIGINT REFERENCES USERS (ID) ON DELETE CASCADE,
	REQUEST BIGINT REFERENCES ITEM_REQUESTS (ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS BOOKINGS (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
    START_DATE TIMESTAMP WITHOUT TIME ZONE,
    END_DATE TIMESTAMP WITHOUT TIME ZONE,
	ITEM_ID BIGINT REFERENCES ITEMS (ID) ON DELETE CASCADE NOT NULL,
	USER_ID BIGINT REFERENCES USERS (ID) ON DELETE CASCADE NOT NULL,
	STATUS VARCHAR NOT NULL
);

CREATE TABLE IF NOT EXISTS COMMENTS (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
	TEXT VARCHAR NOT NULL,
	ITEM_ID BIGINT REFERENCES ITEMS (ID) ON DELETE CASCADE NOT NULL,
	USER_ID BIGINT REFERENCES USERS (ID) ON DELETE CASCADE NOT NULL,
    POST_DATE TIMESTAMP WITHOUT TIME ZONE
);
